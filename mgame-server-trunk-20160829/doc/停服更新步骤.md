
## 停服更新步骤

### 1. 停服列表准备(json)

```json
{
    "stop_list": {
        "PCOS-12072610462": 1,
        "Denny4": 1,
        "DENNY21": 1
    },
    "stop_flag": true
}
```


**说明:**

- `stop_list`代表停服白名单的`openid`,后面的值不用关心。
- `stop_flag`值为`true`和`false`分别代表停服和开服

```json
{
    "status": 1,
    "content": "开服时间|2016年01月23日-10:51:00"
}
```

> 文件位置在115.159.188.208服务器的`fgame/www_9001/server.json` 

**说明:**

- `status`代表`0 停服 ， 1 维护中， 2 开服`
- `content`填好对应内容即中


### 2. 可视化界面进行操作

* 打开`http://115.159.188.208:9101/status/main.html`
* 选择停服白名单页面，输入上面的json
* 确认提交(成功或失败有提示)


### 3. 再次确认

* 可到gslb服务去查看日志，是否操作成功
* 分别用白名单和非白名单用户登录，白名单可进游戏服，停服后的非白名单是不能进游戏服的

### 4. 更新完毕

更新完后，把之前的json的`stop_flag`改成false，`stattus`改成2后，再次确认提交。然后非白名单用户登录是否可进游戏服，可以则表示此次更新完结。不顺利的话需要查看gslb日志确认问题。



<font color=red>
​    
    停服更新后仔细再做一些检查!!

    1. 不同机器的服务是否正常启动，尤其是除逻辑服外的排名服以及日志服
    2. 检查支付回调的代码是否已经更新且配置都是正式环境的配置

</font>



-----------


## 提审到发布

由于有提审到正式的过程，所以有提审包和正式包，为了提审包和正式的包有同样的环境，我们部署了不同的游戏逻辑服，要注意的是他们共享一个登录服。这样我们不得不加一些特殊的参数(版本号)来控制不同的包进入对应的游戏逻辑服。等一切ok后，我们需要进入正式的逻辑服，而非提审包的逻辑服。

<font color=red>
    **注意:**
    支付这块的代码同样需要修改，提审包阶段的支付需要通过提审环境的中心服务给玩家下发商品，提审过后同样需要修改。
</font>

下面的步骤都要做好哟!!

### 1. 提审阶段

- 准备提审的json

```json
{
  "release_flag":true,
  "release_version":2,
  "gamed_addr":"115.159.43.94:9000",
  "gamed_node":"test_gamenode"
}
```

> (文件位置在`setting/release.json`)




- 修改支付回调代码在115.159.188.208服务器(http://115.159.188.208:9101/status/main.html)

按界面操作即可，版本号填对就好。



### 2. 提审过后

- 修改支付回调代码在115.159.188.208服务器(http://115.159.188.208:9101/status/main.html)

按界面操作即可，版本号填对就好。



**setting/release.json字段说明:**

- `release_flag`为true代表当前版本的包是处于提审阶段的，false代表提审通过
- `game_addr`代表提审包的流逻辑服务地址
- `game_node`代表集群节点的名称
- `release_version`代表当前提审包的版本号，下次提审就+1

<font color=red>
    **注意:**
    由于线上有两个login服务，部署的login服务下面的服务器对release_flag的修改都要同步修改
</font>

